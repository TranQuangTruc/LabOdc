<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>LabAdmin - Duyệt Yêu Cầu</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <h2>Yêu cầu thay đổi/hủy chờ duyệt</h2>
    <div id="admin-container"></div>

    <script src="../js/project-service.js"></script>
    <script>
        async function loadPending() {
    try {
        // 1. Gọi API lấy danh sách dự án đang chờ duyệt
        const res = await fetch("http://localhost:8080/api/v1/ideas/pending");
        
        // Kiểm tra nếu API lỗi (ví dụ chưa bật Backend)
        if (!res.ok) throw new Error("Không thể kết nối đến Server");

        const projects = await res.json();
        const container = document.getElementById('admin-container');
        
        // 2. Nếu danh sách rỗng, hiện thông báo cho người dùng
        if (projects.length === 0) {
            container.innerHTML = "<p style='padding:20px;'>Hiện tại không có yêu cầu nào cần duyệt.</p>";
            return;
        }

        // 3. Vẽ các Card dự án ra màn hình
        container.innerHTML = projects.map(p => `
            <div class="card" style="border:1px solid #ddd; padding:20px; margin:15px; border-radius:8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-top:0;">${p.title}</h3>
                <p>Lý do từ Mentor: <strong style="color: #d9534f;">${p.note || "Không có lý do cụ thể"}</strong></p>
                <p>Trạng thái: <span style="background:#eee; padding:2px 6px; border-radius:4px;">${p.status}</span></p>
                <div style="margin-top:15px;">
                    <button onclick="review('${p.id}', true)" style="background:#28a745; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer; margin-right:10px;">Chấp nhận</button>
                    <button onclick="review('${p.id}', false)" style="background:#dc3545; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">Từ chối</button>
                </div>
            </div>
        `).join('');
    } catch (err) {
        // Nếu bị lỗi kết nối hoặc lỗi code, nó sẽ hiện thông báo này thay vì trắng trang
        document.getElementById('admin-container').innerHTML = `<p style='color:red; padding:20px;'>Lỗi: ${err.message}. Hãy kiểm tra xem Backend đã chạy chưa!</p>`;
    }
}

async function review(id, isAccepted) {
    try {
        const res = await fetch(`http://localhost:8080/api/v1/ideas/${id}/review-change?isAccepted=${isAccepted}`, {
            method: 'PUT'
        });
        if (res.ok) {
            alert("Đã xử lý yêu cầu thành công!");
            location.reload(); // Tải lại trang để cập nhật danh sách
        } else {
            alert("Có lỗi xảy ra khi gửi yêu cầu duyệt.");
        }
    } catch (err) {
        alert("Lỗi kết nối: " + err.message);
    }
}

// Chạy hàm khi trang web tải xong
loadPending();
    </script>
</body>
</html>